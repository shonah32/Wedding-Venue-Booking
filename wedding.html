<html> 
<head> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title> S&W Weddings </title>
    <link rel="icon" href="http://example.com/favicon.png">
    <link rel="stylesheet" href="stylesheet.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@200;300;400&family=Playfair+Display:ital@0;1&family=Raleway:ital,wght@0,400;0,500;0,600;1,500&display=swap');
    </style>
</head>

<body> 

    <a href="#scrollDown">
        <div class="parallax position-relative d-flex justify-content-center"> 
        <svg xmlns="http://www.w3.org/2000/svg" width="8%" height="8%" fill="#403d3f" class="bi bi-chevron-compact-down position-absolute bottom-0 pb-4 bounce" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67z"/>
        </svg>
        </div>
    </a>


<br><br><br><br><br>

<br><br>

<div class="container-fluid justify-content-center" id="scrollDown">
    <div class="row">
        <div class="col">
            <center><img src="couple.jpg" class="roundpics img-fluid" alt="Picture of a couple"></center>
        </div>

        <div class="col">
           <center><span class="dreamwedding"> 
               CREATE YOUR DREAM WEDDING 
            </span></center>
            <center><p class="subtext">
               Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus sodales at erat a ultricies. Quisque et orci erat. Nam cursus fermentum augue, quis porta sem scelerisque non. Sed at malesuada sem, at dignissim dui. Nunc vitae ex at enim facilisis feugiat. Nullam dignissim ultrices interdum. Suspendisse non blandit mauris. Sed tristique, tellus non rutrum vestibulum, mi sapien venenatis lectus, feugiat accumsan risus arcu sit amet ligula. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Integer sollicitudin, nisl sed semper imperdiet, sapien arcu posuere ex, a scelerisque libero est sit amet eros. Fusce convallis malesuada egestas. Nunc vulputate convallis eros.
               <br><br><br>
               Etiam libero ante, malesuada sed pharetra vitae, tempus et purus. In ultricies mi sodales tellus iaculis pellentesque. Mauris cursus posuere turpis varius cursus. Proin aliquam, nunc a semper mollis, orci quam condimentum purus, eget suscipit dui mauris quis neque. Maecenas ultricies porttitor porttitor. Sed cursus mattis dolor sed semper. In placerat est velit, non rhoncus ligula rhoncus id. Suspendisse vitae sollicitudin metus. Aenean felis neque, egestas ut est non, molestie pharetra tellus. Maecenas congue accumsan sodales. Nullam eleifend dui ac mattis finibus. Cras vitae ullamcorper diam, quis convallis ante. Curabitur ac orci ultricies, fringilla velit vel, aliquet felis.
            </p></center>
        </div>        
    </div>
</div>

<br><br><br><br> 

<div class="parallax2">
    <center><p class="quote"> "I could not have asked for a better wedding planning company! It truly made my experience much less stressful, and even enjoyable!" </p>
    <p class="quote" id="name"> - Dr. Hossein Nevisi </p></center>
</div>


<br><br><br><br>

<center><p class="headings" id="carouselTitle"> TAKE A PEEK AT OUR GORGEOUS VENUES </p></center>

<br><br>

<center> 
<div id="myCarousel" class="carousel slide pad" data-ride="carousel">

    <!-- Wrapper for slides -->
    <div class="carousel-inner">
        <div class="item active">
            <img src="Haslegrave Hotel.jpg" class="image" alt="Haslegrave Hotel" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Haslegrave Hotel
                </div>
            </div>
        </div>

        <div class="item">
            <img src="Sea View Tavern.jpg" class="image" alt="Sea View Tavern" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Seaview Tavern
                </div>
            </div>
        </div>
    
        <div class="item">
            <img src="Fawlty Towers.jpg" class="image" alt="Fawlty Towers" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Fawlty Towers
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Ashby Castle.jpg" class="image" alt="Ashyby Castle" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Ashby Castle
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Central Plaza.jpg" class="image" alt="Central Plaza" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Central Plaza
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Forest Inn.jpg" class="image" alt="Forest Inn" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Forest Inn
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Hilltop Mansion.jpg" class="image" alt="Hilltop Mansion" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Hilltop Mansion
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Pacific Towers Hotel.jpg" class="image" alt="Pacific Towers Hotel" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Pacific Towers
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Sky Center Complex.jpg" class="image" alt="Sky Center Complex" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Sky Center Complex
                </div>
            </div>
        </div>
    

        <div class="item">
            <img src="Southwestern Estate.jpg" class="image" alt="Southwestern Estate" style="width:100%;">
            <div class="middle">
                <div class="textOverlay">
                    Southwestern Estate 
                </div>
            </div>
        </div>

    <!-- Left and right controls -->
    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
        <span class="sr-only"> Previous </span>
    </a>
    <a class="right carousel-control" href="#myCarousel" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
        <span class="sr-only"> Next </span> 
    </a>
    </div> <!-- end of carousel-inner --> 

</div> <!-- end of carousel --> 
</center> 
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>


<script>

    function updateDate(){

        let val = document.getElementById("dateWanted").value; 

        const tomorrow = new Date(new Date(val).setDate(new Date(val).getDate() + 1)).toISOString().split('T')[0]; 
        document.getElementById("dateWanted2").min = tomorrow; 

        console.log(document.getElementById("dateWanted").min); 
    }


</script>

<form method="get" id="weddingForm"> 
    <div class="parallax3 mt-5">
        <br>
        <p class = "container bookTodayText pt-5 mt-2 pb-2 w-75 text-start"> LIKE WHAT YOU SEE? <br> MAKE A BOOKING TODAY. </p>
        <div class="container bookings w-75"> <!-- big pink container -->
            <div class="row px-5 mx-5" >
                <div class="col mh-100 p-5"> 
                    <div class="row text-start labels">
                        <div class="col-sm p-1">
                            <p class="text-left mb-0 "> Start Date </p>
                        </div>
                        <div class="col-sm text-left">
                            End Date
                        </div>
                        <div class="col-sm text-left">
                            Party Size
                        </div>
                        <div class="col-sm text-left">
                            Catering Grade
                        </div>
                    </div> <!-- end of row -->
                    <div class="row whiteBox p-3 bg-white">
                        <div class="col-sm my-auto"> 
                            <center><input name="dateWanted" class="dateText" id="dateWanted" type="date" min="2022-01-01" max="2025-12-31" onchange="updateDate()" required></center>
                        </div>
                        <div class="col-sm my-auto">
                            <center><input name="dateWanted2" class="dateText" id="dateWanted2" type="date" min="2022-01-01" max="2025-12-31" required></center>
                        </div>
                        <div class="col-sm p-3">
                            <center><input type="range" name="rangeInput" id="rangeInput" min="5" max="1000" step="5" value="5" oninput="amount.value=rangeInput.value" required> <output name="amount" id="amount" for="rangeInput"> 5 </output></center>
                        </div>
                        <div class="col-sm my-auto">
                            <center><select name="cateringGrade" class="dateText selectLabels" id="cateringGrade" class="form-select form-select-lg" name="catering_grade" required>
                            <option value="1"> 1 - Standard </option>
                            <option value="2"> 2 - Bronze </option>
                            <option value="3"> 3 - Silver </option>
                            <option value="4"> 4 - Gold </option>
                            <option value="5"> 5 - Platinum </option>
                            </select></center> 
                        </div>
                    </div> <!-- end of row -->
                </div>

            </div> <!-- end of row div -->
            <br>
            <div class="buttons">
                <center><button type="submit" name="submit" class="btn btn-light mb-5 px-4 buttons"> Submit </button></center> 
            </div>
            <br>

        </div> <!-- end of pink container div -->

    </div> <!-- end of parallax3 div --> 
    
</form> 


<script>
    var today = new Date().toISOString().split('T')[0];
    document.getElementsByName("dateWanted")[0].setAttribute('min', today);
    document.getElementsByName("dateWanted2")[0].setAttribute('min', today);
</script> <!-- prevents the user from choosing a date from the past --> 


<div class="container">
    <div class="row" id="dataResults">
        
    </div>

</div>


</div> <!-- end of container div -->


<script>


    $("#weddingForm").submit(function(event) {
        var formData = {

            dateWanted: $("#dateWanted").val(),

            dateWanted2: $("#dateWanted2").val(),

            rangeInput: $("#rangeInput").val(),

            cateringGrade: $("#cateringGrade").val(),

            };



        $.ajax({
            type: "GET", 
            data: formData,
            url: "sqlhandle.php",
            dataType: "JSON",
            complete: function(response){ 

                if(!response.responseJSON.length){
                    document.getElementById("dataResults").innerHTML = "";
                    $('#dataResults').append(`<center><p class="dateText"> Sorry, there are no results to be shown. </p></center>`);
                }

                else{
                    document.getElementById("dataResults").innerHTML = ""; //clears the page so that it doesn't show any results from previous queries 

                    `<div class="row">`
                    for (let i = 0; i < response.responseJSON.length; i ++) {
                        $('#dataResults').append(` 
                        <div class="col"> <br><br> 
                        <center><div class="card" style="width: 35rem;">
                            <img class="card-img-top" src="${response.responseJSON[i].name}.jpg" alt="${response.responseJSON[i].name}">
                            <div class="card-body ${response.responseJSON[i].name.replace(" ", "-")}"> 
                            <h4 class="card-title"> <b> ${response.responseJSON[i].name} </b></h4> <br>
                            <p class="card-text"> <b> Capacity:</b> ${response.responseJSON[i].capacity} </p>
                            <p class="card-text"> <b> Licensed:</b> ${response.responseJSON[i].licensed} </p>
                            <p class="card-text cost"> <b> Catering cost (pp):</b> £${response.responseJSON[i].cost} </p>
                            <p class="card-text weekPrice"> <b> Price on weekdays:</b> £${response.responseJSON[i].weekday_price} </p>
                            <p class="card-text weekendPrice"> <b> Price on weekends:</b> £${response.responseJSON[i].weekend_price} </p>
                            <p class="card-text"> <b> Previously booked:</b> ${response.responseJSON[i].prev_booked} times</p>
                            <br> 
                            <button class="btn btn-secondary bookNow" id="bookNow" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onclick="run(event)"> Book Now </button> <br><br>
                            </div>
                        </div></center>
                        </div> 
                        `)
                    } `</div>` 
                }
                
            }
        }) 
        event.preventDefault(); //prevents it from refreshing the page 
    }) 

</script>

<br> 

<footer>
    <br><br>
    <center><p> FOLLOW OUR SOCIALS! @SW_weddings <img src="logos2.png" class="socials"></p>
    
    <p> CONTACT US: SW-weddings@weddings.com <br><br> <a href="#top"> BACK TO THE TOP </a>
    </p></center>
    
    <br> 

</footer> 

<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header d-flex align-items-center justify-content-center">
          <h3 class="modal-title makeBooking" id="staticBackdropLabel">Make A Booking</h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="$('#staticBackdrop').modal('hide');"></button>
        </div>
        <div class="modal-body">
            <center><h4 class="chooseDate"> Choose a date: </h4></center>
        <div id="displayModal" class="datesShown d-flex flex-column align-items-center"></div>
        </div>
        <div class="other">
            <hr class="dropdown-divider">
            <br>
            <div id="displayDay" class="dateText mx-5 d-flex justify-content-center"></div>
            <div id="displayPrice" class="dateText mx-5 d-flex justify-content-center"></div>
            <br> 
        </div>
        <div class="modal-footer d-flex justify-content-center">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="$('#staticBackdrop').modal('hide');">Close</button>
          <button type="button" class="btn btn-primary">Book Now</button>
        </div>
    </div>
</div>

<script>

    let selectedVenueDetails;
    
    function run(event){

        const cardBody = event.target.parentNode;
        const cateringCost = cardBody.querySelector('.cost').innerText.split("£")[1]; 
        const weekPrice = cardBody.querySelector('.weekPrice').innerText.split("£")[1];
        const weekendPrice = cardBody.querySelector('.weekendPrice').innerText.split("£")[1];

        const data = {
            cateringCost: cateringCost,
            weekPrice: weekPrice,
            weekendPrice: weekendPrice
        };

        selectedVenueDetails = {...data};
        console.log(selectedVenueDetails)

        let x = document.getElementById("bookNow");
        if (!x) return //makes sure it only runs the next bit of the code if it's not loaded yet 
        
        x.addEventListener("click", showModal());
        x.addEventListener("click", displayDates());
        

        function showModal(){
            $('#staticBackdrop').modal('show');
        }

        function getDatesInRange(startDate, endDate) {
            
            const date = new Date(startDate.getTime());

            const dates = [];

            while (date <= endDate) {
                dates.push(new Date(date).toISOString().slice(0,10));
                date.setDate(date.getDate() + 1);
            }

            return dates;
        }


        function getDay(dateWanted){
            var nData = new Date(dateWanted) ;
            console.log(nData); 

            switch (nData.getDay()) {
                case 0:
                    day = "Sunday";
                    break;
                case 1:
                    day = "Monday";
                    break;
                case 2:
                    day = "Tuesday";
                    break;
                case 3:
                    day = "Wednesday";
                    break;
                case 4:
                    day = "Thursday";
                    break;
                case 5:
                    day = "Friday";
                    break;
                case 6:
                    day = "Saturday";
            }
            return day; 
        }

        function determineWeekend(dateWanted){
            var givenDate=new Date(dateWanted.toString());
            var dayOfWeek = givenDate.getDay();
            var isWeekend = (dayOfWeek === 6) || (dayOfWeek  === 0); // Saturday = 6, Sunday = 0 
            console.log(isWeekend); 
            return isWeekend; 
        } 

        function totalPrice(cost, partySize, weekendPrice, weekdayPrice, radiosChecked){
            let totalCost = 0;
            if(determineWeekend(radiosChecked.value) == true){
                totalCost = (cost * partySize);
                totalCost = +totalCost + +weekendPrice;
            }
            else{
                totalCost = (cost * partySize);
                totalCost = +totalCost + +weekdayPrice;
            }
            console.log(totalCost); 
            return totalCost; 
        }


        function displayDates(){
            let venueName = event.target.parentNode.querySelector('.card-title').textContent.trim();

            var formData2 = {

            dateWanted: $("#dateWanted").val(),

            dateWanted2: $("#dateWanted2").val(),

            venueName: venueName

            };

            datesInRange = getDatesInRange(new Date(dateWanted.value), new Date(dateWanted2.value)); 
            
            $.ajax({
                    type: "GET", 
                    data: formData2,
                    url: "availabledays.php",
                    dataType: "JSON",
                    complete: function(response){

                        document.getElementById("displayModal").innerHTML = "";

                        let dates = [];

                        for(let i=0; i <response.responseJSON.length; i++){
                            dates.push(response.responseJSON[i].booking_date);
                        }

                        for (let i=0; i < datesInRange.length; i++) {
                            $('#displayModal').append(`
                            <div class="form-check">
                            <input class="form-check-input" type="radio" value="${datesInRange[i]}" id="flexRadioDefault" name="radioButton" ${(dates).includes(datesInRange[i]) ? "disabled" : "" }>
                            <label class="form-check-label" for="flexRadioDefault">
                                ${datesInRange[i]} 
                                
                            </label>
                            </div>
                        `)

                        } //end of for loop 
                        
                    }
                    

                }) //end of ajax 

                document.getElementById("displayModal").onchange = function(event){
                    let radiosChecked = document.querySelector("input[name='radioButton']:checked"); //gets the date of the radio button checked 
                    document.getElementById("displayDay").innerHTML = "<strong class='mx-2'> The day you chose: </strong>" +  getDay(radiosChecked.value); 

                    const {cateringCost, weekPrice, weekendPrice} = selectedVenueDetails; 
                    document.getElementById("displayPrice").innerHTML = "<strong class='mx-2'> The total price:</strong> £" + totalPrice(cateringCost, rangeInput.value, weekendPrice, weekPrice, radiosChecked); 
                    
                    
                } //gets which radio button is checked by the user 


        } //end of displayDates function 


    } //end of function run(event) 
    

</script>

</body>
</html>
